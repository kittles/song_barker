<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HEGMD1PLK4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-HEGMD1PLK4');
    </script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NF5TN6XP');</script>
    <!-- End Google Tag Manager -->

    <link rel="stylesheet" type="text/css" href="/puppet/loading_spinner.css">
    <link rel="stylesheet" type="text/css" href="/puppet/puppet.css">

    <!-- fav icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <meta property="og:title" content="K9 Karaoke Card">
    <meta property="og:description" content="Someone's pet has a message for you">
    <meta property="og:image" content="https://storage.googleapis.com/{{bucket_name}}/{{image_bucket_fp}}">
    <meta property="og:url" content="https://{{domain_name}}/card/{{uuid}}">

    <meta name="twitter:title" content="K9 Karaoke Card">
    <meta name="twitter:description" content="Someone's pet has a message for you">
    <meta name="twitter:image" content="https://storage.googleapis.com/{{bucket_name}}/{{image_bucket_fp}}">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="viewport" content="width=device-width, user-scalable=no">

</head>
<body>
        <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NF5TN6XP"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="container">
        <div id="flap"         class="envelope-piece above"></div>
        <div id="pouch"        class="envelope-piece above"></div>
        <div id="pouch-inside" class="envelope-piece above"></div>
        <div id="message" style="display: none">
            <div id="message-cover"></div>
            <div class="lds-default loading-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
        </div>

        <!-- app logo -->
        <div id="k9-logo">
            <img id="logo-image" src="/puppet/k9_logotype_small.png"></img>
        </div>

        <!-- all the controls on the left side -->
        <div id="desktop-controls" style="display: none">
            <!-- share button -->
            <div style="height: 20%">
                <div id="share-button">
                    <div id="share-text">SHARE</div>
                </div>
            </div>
            <!-- hr -->
            <div style="height: 8%">
                <hr id="desktop-hr"></hr>
            </div>
            <!-- share icons -->
            <div style="height: 15%">
                <div id="desktop-share-icons">
                    <div class="desktop-share-icon"><img id="facebook-badge" src="/puppet/icons/social facebook.svg"></img></div>
                    <div class="desktop-share-icon"><img id="instagram-badge" src="/puppet/icons/social instagram.svg"></img></div>
                </div>
            </div>
            <!-- playback controls -->
            <div class="blue-background" style="height: auto; width: 100%; margin-top: 15%">
                <div id="desktop-play" style="height: 15%; padding-top: 13%">
                    <img class="flex-icon v-center" src="/puppet/k9-icons/play-no-border-white.png"></img>
                </div>
                <div id="desktop-replay" style="height: 15%">
                    <img class="flex-icon v-center" src="/puppet/k9-icons/replay-no-border-white.png"></img>
                </div>
                <div id="desktop-volume-icon" style="height: 15%">
                    <img class="flex-icon v-center" src="/puppet/k9-icons/volume-on-no-border-white.png"></img>
                </div>
                <div style="height: 65%">
                    <input class="v-center range-vertical" type="range" id="desktop-volume-slider"></input>
                </div>
            </div>
        </div>

        <!-- controls on the right side -->
        <div id="desktop-app-links" style="display: none">
            <div id="app-tag-line">MAKE YOUR PETS SING!</div>
            <div id="app-subhead">Check out K-9 Karaoke</div>
            <div id="app-logos">
                <div>
                    <img class="app-image-link" src="/puppet/k9_logotype_small.png"></img>
                </div>
            </div>
            <div id="app-badges">
                <div class="app-badge-side">
                    <img id="app-store-badge" src="/puppet/app-store-badge.png"></img>
                </div>
                <div class="app-badge-side">
                    <img id="google-play-badge" src="/puppet/google-play-badge.png"></img>
                </div>
            </div>
        </div>

        <!-- mobile stuff all goes below the puppet -->
        <div id="mobile-bottom-controls" style="display: none">
            <!-- share -->
            <div id="mobile-share-button">
                <div>SHARE</div>
            </div>
            <!-- hr -->
            <hr id="mobile-hr"></hr>
            <!-- app links and such -->
            <div id="mobile-app-tag-line">MAKE YOUR PETS SING!</div>
            <div id="mobile-app-subhead">Check out K-9 Karaoke</div>
            <div id="mobile-app-logos">
                <div>
                    <img class="app-image-link" src="/puppet/k9_logotype_small.png"></img>
                </div>
            </div>
            <div id="mobile-app-badges">
                <div class="app-badge">
                    <img id="mobile-app-store-badge" src="/puppet/app-store-badge.png"></img>
                </div>
                <div class="app-badge">
                    <img id="mobile-google-play-badge" src="/puppet/google-play-badge.png"></img>
                </div>
            </div>
        </div>
    </div>
    <script src="/puppet/jquery.min.js"></script>
    <script src="/puppet/easing.js"></script>
    <script src="/puppet/lodash.js"></script>
    <script src="/puppet/lodash.fp.js"></script>
    <script src="/puppet/three.110.js"></script>
    <script src="/puppet/gltf_loader.js"></script>
    <script src="/puppet/orbit_controls.js"></script>
    <script src="/puppet/stats.min.js"></script>
    <script src="/puppet/raf.js"></script>
    <script src="/puppet/performance.js"></script>
    <script src="/puppet/math.min.js"></script>
    <!-- for transpiling async await -->
    <script src="/puppet/runtime.js"></script>
    <script>
        try {
            window.greeting_card = {};
            window.greeting_card.uuid='{{uuid}}';
            window.greeting_card.card_audio_bucket_fp='{{card_audio_bucket_fp}}';
            window.greeting_card.image_bucket_fp='{{image_bucket_fp}}';
            window.greeting_card.decoration_image_bucket_fp='{{decoration_image_bucket_fp}}';
            window.greeting_card.animation_json=JSON.parse('{{{animation_json}}}');
            window.greeting_card.image_coordinates_json=JSON.parse('{{{image_coordinates_json}}}');
            window.greeting_card.name='{{name}}';
            window.greeting_card.recipient_name='{{recipient_name}}';
            window.greeting_card.mouth_color='{{mouth_color}}';
            window.greeting_card.lip_color='{{lip_color}}';
            window.greeting_card.lip_thickness='{{lip_thickness}}';
            window.greeting_card.has_envelope=parseInt('{{has_envelope}}');
            window.greeting_card.bucket_name='{{bucket_name}}';

            // TODO remember why this is here...
            if (!window.greeting_card.image_bucket_fp) {
                window.greeting_card.image_bucket_fp = `images/${window.greeting_card.image_id}.jpg`;
            }
        } catch (error) {
            $(document).ready(() => {
                $('#error-message').text(`problem with greeting_card values: ${error}`);
                $('#error').fadeIn(100);
            });
        }
    </script>
    <!-- this handles scaling the content -->
    <script src="/puppet/puppet-scaling.js"></script>
    <!-- end move -->

    <!-- JMF Web Share API Bindings -->
    <script>
        const shareData = {
            title: 'K9 Karaoke',
            text: 'Make Your Pets Sing!',
            url: document.location.href,
        }

        const shareButton = document.getElementById('share-button');
        const mobileShareButton = document.getElementById('mobile-share-button');

        async function shareCard() {
            try {
                await navigator.share(shareData)
                console.log('MDN shared successfully');
            } catch(err) {
                console.log('Error: ' + err);
            }
        }

        // Must be triggered some kind of "user activation"
        shareButton.addEventListener('click', shareCard);
        mobileShareButton.addEventListener('click', shareCard);
    </script>
    <!-- End JMF Web Share API Bindings -->

    <!-- JMF Other button bindings -->
    <script>
        //The google might change when in store, the apple id won't work until published
        const googlePlayAndroidURL = "https://play.google.com/store/apps/details?id=com.turboblasterunlimited.k9_karaoke";
        const appleConnectURL = "https://apps.apple.com/us/app/k-9-karaoke/id1535425619";
        const faceBookURL = "https://www.facebook.com/K9KarokeApp/";
        const instagramURL = "https://www.instagram.com/k_9karaoke/";

        const appStoreBadge = document.getElementById('app-store-badge');
        const googlePlayBadge = document.getElementById("google-play-badge");

        const facebookBadge = document.getElementById("facebook-badge");
        const instagramBadge = document.getElementById("instagram-badge");

        const mobileAppStoreBadge = document.getElementById("mobile-app-store-badge");
        const mobileGooglePlayBadge = document.getElementById("mobile-google-play-badge");

        function gotoGooglePlay() {
            window.location.href = googlePlayAndroidURL;
        }
        function gotoAppStore() {
            window.location.href = appleConnectURL;
        }
        function gotoFacebook() {
            window.location.href = faceBookURL;
        }
        function gotoInstagram() {
            window.location.href = instagramURL;
        }

        appStoreBadge.addEventListener('click', gotoAppStore);
        mobileAppStoreBadge.addEventListener('click', gotoAppStore);

        googlePlayBadge.addEventListener('click', gotoGooglePlay);
        mobileGooglePlayBadge.addEventListener('click', gotoGooglePlay);

        facebookBadge.addEventListener('click', gotoFacebook);
        instagramBadge.addEventListener('click', gotoInstagram);


    </script>
    <!-- End JMF Other button bindings -->

    <script src="/build/puppet.js"></script>
</body>
